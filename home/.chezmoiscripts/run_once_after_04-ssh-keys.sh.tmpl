#!/usr/bin/env bash

{{ template "common" }}

set_ssh_keys() {
  bot "Checking ssh keys..."
  echo
  if [ ! -f ~/.ssh/id_ed25519 ] ; then
    read -p "Would you like to set ssh keys now? [y/N]" -n 1 answer
    if [[ $answer =~ (yes|y|Y) ]] ; then
      echo "Setting ssh keys using the ed25519 algorithm."
      read -p "Enter the passphrase: (empty for no passphrase)" passphrase
      action "ssh-keygen -t ed25519 -C {{- .email }} -q -N \"$passphrase\""
      ssh-keygen -t ed25519 -C {{- .email }} -q -N "$passphrase"
      ssh-add ~/.ssh/id_ed25519
    else
      ok "Skipping"
    fi
  else
    ok "ssh keys already present!"
  fi
}

set_ghithub_ssh_key() {
  if [ -f ~/.ssh/id_ed25519 ] && _exists gh ; then
    read -p "Would you like to set your public ssh key to your gh account? [y/N]" -n 1 answer
    if [[ $answer =~ (yes|y|Y) ]] ; then
      action "gh auth login"
      gh auth login
    else
      ok "Skipping"
    fi
  fi
}

main() {
  set_ssh_keys "$*"
  set_ghithub_ssh_key "$*"
}

main "$*"
